{% load static %}

<header class="header">
    <div class="header-content">
        <div class="logo">
            <a href="{% url 'home' %}">
                <img src="{% static 'img/logo.svg' %}" alt="Fashion Shop">
            </a>
        </div>
        
        <nav class="nav">
            <ul class="nav-menu">
                <li><a href="{% url 'home' %}">Trang ch·ªß</a></li>
                <li><a href="{% url 'home' %}">S·∫£n ph·∫©m</a></li>
                <li><a href="#">V·ªÅ ch√∫ng t√¥i</a></li>
                <li><a href="#">Li√™n h·ªá</a></li>
            </ul>
        </nav>
        
        <div class="header-actions">
            <!-- Add cart button and user menu -->
            <div class="search-box">
                <form method="GET" action="{% url 'home' %}">
                    <input type="text" name="search" placeholder="T√¨m ki·∫øm...">
                    <button type="submit">üîç</button>
                </form>
            </div>
            
            <!-- Cart Button -->
            <a href="{% url 'cart' %}" class="cart-btn" title="Gi·ªè h√†ng">
                üõí <span class="cart-count">0</span>
            </a>
            
            <!-- User Menu -->
            {% if user.is_authenticated %}
                <div class="user-menu">
                    <button class="user-btn">{{ user.username }}</button>
                    <div class="user-dropdown">
                        <a href="{% url 'my_orders' %}">ƒê∆°n h√†ng c·ªßa t√¥i</a>
                        <a href="#">T√†i kho·∫£n</a>
                        <a href="{% url 'logout' %}">ƒêƒÉng xu·∫•t</a>
                    </div>
    <div class="header__wrap content row">
        <a class="logo" href="{% url 'home' %}">
            <img src="{% static 'img/logo.svg' %}" alt="Logo" class="logo_main">
        </a>
        <div class="icon__dash">‚ò∞</div>

        <div class="header__main">
            <nav class="nav">
                <ul class="nav__container row">
                    <li class="nav__item">
                        <a href="{% url 'home' %}" class="nav__item__link nav__item__link--active" id="home_nav">Home</a>
                    </li>
                    <li class="nav__item">
                        <a href="" class="nav__item__link">Contacts</a>
                    </li>
                    <li class="nav__item">
                        <a href="{% url 'management' %}" class="nav__item__link" id="admin">Management</a>
                    </li>
                    <li class="nav__item">
                        <a href="{% url 'cart:cart_page' %}" class="nav__item__link">Cart</a>
                    </li>
                </ul>
            </nav>

            <!-- sign in -->
            <div class="signIn">
                <div class="signIn__wrap">
                    {% if user.is_authenticated %}
                        <span class="user__name">Hello, {{ user.username }}</span>
                        <form action="{% url 'logout' %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn">Log Out</button>
                        </form>

                    {% else %}
                        <a href="{% url 'login' %}" class="logIn">Log In</a>
                        <a href="" class="signUp__btn btn">Sign Up</a>
                    {% endif %}
                </div>
            </div>


            <div class="user unactive">
                <div class="user__wrap row">
                    <span class="user__name"></span>
                    <img src="{% static 'img/user-Img.png' %}" alt="User" class="user__img">

                    <a href="{% url 'cart:cart_page' %}">
                        <div class="cart-quantity"><span class="cart-quantity-text"></span></div>
                        <img src="{% static 'img/img__cart.png' %}" alt="Cart" class="cart__img">
                    </a>            

                    <img src="{% static 'img/signOut-icon.png' %}" alt="Sign out" class="sign__out">
                </div>
            {% else %}
                <a href="{% url 'login' %}" class="auth-btn">ƒêƒÉng nh·∫≠p</a>
                <a href="{% url 'signup' %}" class="auth-btn auth-btn-primary">ƒêƒÉng k√Ω</a>
            {% endif %}
        </div>
    </div>
</header>

<style>
    .header-actions {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .search-box form {
        display: flex;
        align-items: center;
        background: #f5f5f5;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .search-box input {
        border: none;
        background: none;
        padding: 8px 12px;
        font-size: 14px;
        width: 200px;
    }
    
    .search-box input:focus {
        outline: none;
    }
    
    .search-box button {
        border: none;
        background: none;
        cursor: pointer;
        padding: 8px 12px;
        font-size: 16px;
    }
    
    .cart-btn {
        display: flex;
        align-items: center;
        gap: 4px;
        color: #000;
        text-decoration: none;
        font-weight: 500;
        position: relative;
    }
    
    .cart-btn:hover {
        color: #333;
    }
    
    .cart-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 20px;
        height: 20px;
        background: #d32f2f;
        color: #fff;
        border-radius: 50%;
        font-size: 12px;
        font-weight: bold;
    }
    
    .user-menu {
        position: relative;
    }
    
    .user-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        color: #000;
        padding: 8px 12px;
        border-radius: 4px;
    }
    
    .user-btn:hover {
        background: #f5f5f5;
    }
    
    .user-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        min-width: 200px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        z-index: 1000;
    }
    
    .user-menu:hover .user-dropdown {
        display: flex;
        flex-direction: column;
    }
    
    .user-dropdown a {
        padding: 12px 16px;
        color: #333;
        text-decoration: none;
        font-size: 14px;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .user-dropdown a:last-child {
        border-bottom: none;
    }
    
    .user-dropdown a:hover {
        background: #f5f5f5;
    }
    
    .auth-btn {
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        color: #000;
        border: 1px solid #000;
        transition: all 0.3s ease;
    }
    
    .auth-btn:hover {
        background: #f5f5f5;
    }
    
    .auth-btn-primary {
        background: #000;
        color: #fff;
        border-color: #000;
    }
    
    .auth-btn-primary:hover {
        background: #333;
    }
</style>

<script>
// Update cart count
function updateCartCount() {
    const cart = localStorage.getItem('fashionshop_cart');
    const items = cart ? JSON.parse(cart) : [];
    const count = items.length;
    const countElement = document.querySelector('.cart-count');
    if (countElement) {
        countElement.textContent = count;
        countElement.style.display = count > 0 ? 'inline-flex' : 'none';
    }
}

document.addEventListener('DOMContentLoaded', updateCartCount);
window.addEventListener('storage', updateCartCount);

document.querySelector('.cart-btn')?.addEventListener('click', function(e) {
    const isAuthenticated = "{{ user.is_authenticated|lower }}" === 'true';
    if (!isAuthenticated) {
        e.preventDefault();
        window.location.href = "{% url 'login' %}";
    }
});
</script>
